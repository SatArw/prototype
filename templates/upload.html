<!DOCTYPE html>
<html>
<head>
    <title>Image Upload</title>
    <style>
        #canvas, #preview {
            max-width: 100%;
            height: auto;
        }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <center><h1>Image Upload</h1></center>

    <center><div id="camera-section">
        <h2>Take a picture</h2>
        <center><video id="video" autoplay></video></center>
        <canvas id="canvas"></canvas>
        <br>
        <button id="capture">Capture Image</button>
    </div></center>

    <center><div id="file-section">
        <h2>Upload an image</h2>
        <form action="/upload" method="post" enctype="multipart/form-data">
            <input type="file" name="file">
            <br><br>
            <input type="submit" value="Upload">
        </form>
    </div></center>

    <center><div id="preview-section">
        <h2>Preview</h2>
        <img id="preview">
        <form action="/results" method="post">
            <input type="hidden" name="img_data" id="img_data" value="">
            <br><br>
            <input type="submit" value="Grade">
        </form>
    </div></center>

    <script>
        const cameraSection = document.getElementById('camera-section');
        const fileSection = document.getElementById('file-section');
        const previewSection = document.getElementById('preview-section');
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');
        const captureButton = document.getElementById('capture');
        const previewImg = document.getElementById('preview');
        const imgDataInput = document.getElementById('img_data');

        function showCameraSection() {
            cameraSection.style.display = 'block';
            fileSection.style.display = 'none';
        }

        function showFileSection() {
            cameraSection.style.display = 'none';
            fileSection.style.display = 'block';
        }

        function showPreviewSection(imgData) {
            cameraSection.style.display = 'none';
            fileSection.style.display = 'none';
            previewSection.style.display = 'block';
            previewImg.src = imgData;
            imgDataInput.value = imgData;
        }

        function capture() {
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imgData = canvas.toDataURL('image/jpeg');
            showPreviewSection(imgData);
        }

        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
            })
            .catch(error => {
                console.error(error);
                showFileSection();
            });

        captureButton.addEventListener('click', capture);
    </script>
</body>
</html>
